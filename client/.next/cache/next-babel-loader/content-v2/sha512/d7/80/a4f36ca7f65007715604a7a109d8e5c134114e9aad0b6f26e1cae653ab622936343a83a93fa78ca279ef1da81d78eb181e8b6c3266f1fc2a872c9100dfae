{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _readOnlyError from \"@babel/runtime/helpers/esm/readOnlyError\";\n\nvar _jsxFileName = \"C:\\\\Users\\\\foubroker\\\\PROJECT_VOTE\\\\voting-at-mcgill\\\\client\\\\src\\\\pages\\\\index.js\",\n    _s = $RefreshSig$();\n\nvar __jsx = React.createElement;\nimport React, { useState, useEffect } from \"react\";\nimport { makeStyles } from '@material-ui/core/styles';\nimport VoteFactoryContract from \"../contracts/VoteFactory.json\";\nimport VoteContract from \"../contracts/Vote.json\";\nimport getWeb3 from \"../getWeb3\";\nimport { Header } from '../components/header';\nimport { Link } from '../../routes';\nimport 'semantic-ui-css/semantic.min.css'; // CommonJS\n\nrequire(\"regenerator-runtime/runtime\");\n\nvar useStyles = makeStyles({\n  card: {\n    width: '80%'\n  }\n});\n\nfunction App() {\n  _s();\n\n  var _useState = useState(''),\n      web3 = _useState[0],\n      setWeb3 = _useState[1]; // const [votesAddresses, setVotesAddresses] = useState('');\n\n\n  var _useState2 = useState(''),\n      contract = _useState2[0],\n      setContract = _useState2[1];\n\n  var _useState3 = useState([]),\n      renderedAddresses = _useState3[0],\n      renderAddresses = _useState3[1];\n\n  useEffect(function () {\n    // get web3\n    function initWeb3() {\n      return _initWeb.apply(this, arguments);\n    }\n\n    function _initWeb() {\n      _initWeb = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n        var web3Instance;\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                console.log('initializing web3');\n                _context.next = 3;\n                return getWeb3();\n\n              case 3:\n                web3Instance = _context.sent;\n                setWeb3(web3Instance);\n\n              case 5:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee);\n      }));\n      return _initWeb.apply(this, arguments);\n    }\n\n    initWeb3();\n  }, []);\n  useEffect(function () {\n    // get Factory contract\n    function setup() {\n      return _setup.apply(this, arguments);\n    }\n\n    function _setup() {\n      _setup = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n        var networkId, deployedNetwork, instance;\n        return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                if (!(web3 == \"\")) {\n                  _context2.next = 3;\n                  break;\n                }\n\n                console.log('unable to get factory');\n                return _context2.abrupt(\"return\");\n\n              case 3:\n                console.log(\"web3 initialized\");\n                _context2.prev = 4;\n                _context2.next = 7;\n                return web3.eth.net.getId();\n\n              case 7:\n                networkId = _context2.sent;\n                deployedNetwork = VoteFactoryContract.networks[networkId];\n                instance = new web3.eth.Contract(VoteFactoryContract.abi, deployedNetwork && deployedNetwork.address);\n                setContract(instance); // Set web3, accounts, and contract to the state, and then proceed with an\n\n                _context2.next = 17;\n                break;\n\n              case 13:\n                _context2.prev = 13;\n                _context2.t0 = _context2[\"catch\"](4);\n                // Catch any errors for any of the above operations.\n                alert(\"Failed to load web3, accounts, or contract. Check console for details.\");\n                console.error(_context2.t0);\n\n              case 17:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, null, [[4, 13]]);\n      }));\n      return _setup.apply(this, arguments);\n    }\n\n    setup(); // console.log('ok')\n  }, [web3]);\n  useEffect(function () {\n    //display available votes addresses\n    var votesAddresses;\n\n    var displayVotes = /*#__PURE__*/function () {\n      var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3() {\n        return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                if (!(contract == '')) {\n                  _context3.next = 2;\n                  break;\n                }\n\n                return _context3.abrupt(\"return\");\n\n              case 2:\n                _context3.next = 4;\n                return contract.methods.getDeployedVotes().call();\n\n              case 4:\n                votesAddresses = _context3.sent;\n                console.log(votesAddresses); // Update state with the result.\n                // setVotesAddresses(response);\n\n              case 6:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3);\n      }));\n\n      return function displayVotes() {\n        return _ref.apply(this, arguments);\n      };\n    }();\n\n    var displayInfo = /*#__PURE__*/function () {\n      var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee4(address) {\n        var instance;\n        return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n          while (1) {\n            switch (_context4.prev = _context4.next) {\n              case 0:\n                if (!(votesAddresses == '')) {\n                  _context4.next = 2;\n                  break;\n                }\n\n                return _context4.abrupt(\"return\");\n\n              case 2:\n                _context4.prev = 2;\n                // Get the contract instance.\n                instance = new web3.eth.Contract(VoteContract.abi, address);\n                _context4.next = 6;\n                return instance.methods.currentElection().call();\n\n              case 6:\n                return _context4.abrupt(\"return\", _context4.sent);\n\n              case 9:\n                _context4.prev = 9;\n                _context4.t0 = _context4[\"catch\"](2);\n                // Catch any errors for any of the above operations.\n                alert(\"Failed to load web3, accounts, or contract. Check console for details.\");\n                console.error(_context4.t0);\n\n              case 13:\n              case \"end\":\n                return _context4.stop();\n            }\n          }\n        }, _callee4, null, [[2, 9]]);\n      }));\n\n      return function displayInfo(_x) {\n        return _ref2.apply(this, arguments);\n      };\n    }();\n\n    var renderVotes = /*#__PURE__*/function () {\n      var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee5() {\n        var temp;\n        return _regeneratorRuntime.wrap(function _callee5$(_context5) {\n          while (1) {\n            switch (_context5.prev = _context5.next) {\n              case 0:\n                if (votesAddresses) {\n                  _context5.next = 2;\n                  break;\n                }\n\n                return _context5.abrupt(\"return\");\n\n              case 2:\n                temp = [];\n                votesAddresses.forEach(function (address) {\n                  displayInfo(address).then(function (newAddress) {\n                    return temp.push(newAddress);\n                  });\n                });\n                renderAddresses(temp);\n\n              case 5:\n              case \"end\":\n                return _context5.stop();\n            }\n          }\n        }, _callee5);\n      }));\n\n      return function renderVotes() {\n        return _ref3.apply(this, arguments);\n      };\n    }();\n\n    displayVotes();\n    renderVotes();\n  }, [contract]);\n\n  function displayVoteList() {\n    var _this = this;\n\n    if (renderedAddresses == \"\") {\n      return __jsx(\"div\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 113,\n          columnNumber: 14\n        }\n      }, \"no votes to display\");\n    }\n\n    return renderedAddresses.map(function (vote, index) {\n      return __jsx(Link, {\n        className: \"ui button\",\n        route: \"/elections/vote/\".concat(vote),\n        key: index,\n        __self: _this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 116,\n          columnNumber: 9\n        }\n      }, __jsx(\"div\", {\n        className: \"ui link card\",\n        style: {\n          width: \"80%\"\n        },\n        __self: _this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 117,\n          columnNumber: 9\n        }\n      }, __jsx(\"div\", {\n        className: \"card\",\n        __self: _this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 118,\n          columnNumber: 9\n        }\n      }, __jsx(\"div\", {\n        className: \"content\",\n        __self: _this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 119,\n          columnNumber: 9\n        }\n      }, __jsx(\"div\", {\n        className: \"header\",\n        __self: _this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 120,\n          columnNumber: 11\n        }\n      }, \"Election\"), __jsx(\"div\", {\n        className: \"meta\",\n        __self: _this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 121,\n          columnNumber: 11\n        }\n      }, __jsx(\"a\", {\n        __self: _this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 122,\n          columnNumber: 13\n        }\n      }, vote)), __jsx(\"div\", {\n        className: \"description\",\n        __self: _this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 124,\n          columnNumber: 11\n        }\n      }, \"Click to Vote\")), __jsx(\"div\", {\n        className: \"extra content\",\n        __self: _this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 128,\n          columnNumber: 9\n        }\n      }, __jsx(\"span\", {\n        __self: _this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 129,\n          columnNumber: 11\n        }\n      }, __jsx(\"i\", {\n        className: \"user icon\",\n        __self: _this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 130,\n          columnNumber: 13\n        }\n      }), \"0 votes\")))));\n    });\n  }\n\n  function clicked() {\n    console.log(renderedAddresses);\n  }\n\n  function initWeb3() {\n    return _initWeb2.apply(this, arguments);\n  }\n\n  function _initWeb2() {\n    _initWeb2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee6() {\n      return _regeneratorRuntime.wrap(function _callee6$(_context6) {\n        while (1) {\n          switch (_context6.prev = _context6.next) {\n            case 0:\n              if (!(web3 = (_readOnlyError(\"web3\"), \"\"))) {\n                _context6.next = 6;\n                break;\n              }\n\n              _context6.t0 = setWeb3;\n              _context6.next = 4;\n              return getWeb3();\n\n            case 4:\n              _context6.t1 = _context6.sent;\n              (0, _context6.t0)(_context6.t1);\n\n            case 6:\n            case \"end\":\n              return _context6.stop();\n          }\n        }\n      }, _callee6);\n    }));\n    return _initWeb2.apply(this, arguments);\n  }\n\n  return __jsx(React.Fragment, null, __jsx(Header, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 148,\n      columnNumber: 7\n    }\n  }), __jsx(\"br\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 149,\n      columnNumber: 7\n    }\n  }), __jsx(\"br\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 150,\n      columnNumber: 7\n    }\n  }), __jsx(\"br\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 151,\n      columnNumber: 7\n    }\n  }), __jsx(\"br\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 152,\n      columnNumber: 7\n    }\n  }), __jsx(\"div\", {\n    className: \"App\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 153,\n      columnNumber: 7\n    }\n  }, __jsx(\"button\", {\n    onClick: clicked,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 154,\n      columnNumber: 9\n    }\n  }), __jsx(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 156,\n      columnNumber: 9\n    }\n  }, displayVoteList())));\n}\n\n_s(App, \"2gXeIhJfahbY/psC8DwmVO5GQaA=\");\n\n_c = App;\nexport default App;\n\nvar _c;\n\n$RefreshReg$(_c, \"App\");","map":{"version":3,"sources":["C:/Users/foubroker/PROJECT_VOTE/voting-at-mcgill/client/src/pages/index.js"],"names":["React","useState","useEffect","makeStyles","VoteFactoryContract","VoteContract","getWeb3","Header","Link","require","useStyles","card","width","App","web3","setWeb3","contract","setContract","renderedAddresses","renderAddresses","initWeb3","console","log","web3Instance","setup","eth","net","getId","networkId","deployedNetwork","networks","instance","Contract","abi","address","alert","error","votesAddresses","displayVotes","methods","getDeployedVotes","call","displayInfo","currentElection","renderVotes","temp","forEach","then","newAddress","push","displayVoteList","map","vote","index","clicked"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from \"react\";\r\nimport { makeStyles } from '@material-ui/core/styles';\r\nimport VoteFactoryContract from \"../contracts/VoteFactory.json\";\r\nimport VoteContract from \"../contracts/Vote.json\";\r\nimport getWeb3 from \"../getWeb3\";\r\nimport { Header } from '../components/header';\r\nimport { Link } from '../../routes'\r\nimport 'semantic-ui-css/semantic.min.css';\r\n// CommonJS\r\nrequire(\"regenerator-runtime/runtime\");\r\n\r\nconst useStyles = makeStyles({\r\n  card: {\r\n    width:'80%'\r\n  }\r\n});\r\n\r\nfunction App() {\r\n  const [web3, setWeb3] = useState('');\r\n  // const [votesAddresses, setVotesAddresses] = useState('');\r\n  const [contract, setContract] = useState('');\r\n  const [renderedAddresses, renderAddresses] = useState([]);\r\n\r\n  useEffect(() => {// get web3\r\n    async function initWeb3() {\r\n      console.log('initializing web3');\r\n      const web3Instance = await getWeb3();\r\n      setWeb3(web3Instance)\r\n    }\r\n    initWeb3();\r\n  },[]);\r\n\r\n  useEffect(() => {// get Factory contract\r\n    async function setup() {\r\n      if(web3 == \"\") {\r\n        console.log('unable to get factory')\r\n        return;\r\n      }\r\n      console.log(\"web3 initialized\")\r\n      try {\r\n        // Get the contract instance.\r\n        const networkId = await web3.eth.net.getId();\r\n        const deployedNetwork = VoteFactoryContract.networks[networkId];\r\n        const instance = new web3.eth.Contract(\r\n          VoteFactoryContract.abi,\r\n          deployedNetwork && deployedNetwork.address,\r\n        );\r\n        setContract(instance);\r\n    \r\n        // Set web3, accounts, and contract to the state, and then proceed with an\r\n      } catch (error) {\r\n        // Catch any errors for any of the above operations.\r\n        alert(\r\n          `Failed to load web3, accounts, or contract. Check console for details.`,\r\n        );\r\n        console.error(error);\r\n      }\r\n    }\r\n      setup();\r\n      // console.log('ok')\r\n  },[web3]);\r\n\r\n  useEffect(()=> {//display available votes addresses\r\n    var votesAddresses\r\n    var displayVotes = async () => {\r\n      if(contract == ''){\r\n        return;\r\n      }\r\n      votesAddresses = await contract.methods.getDeployedVotes().call();\r\n      console.log(votesAddresses)\r\n      // Update state with the result.\r\n      // setVotesAddresses(response);\r\n    };\r\n        var displayInfo = async (address) => { \r\n      if(votesAddresses == '') {\r\n        return;\r\n      }\r\n      try {\r\n        // Get the contract instance.\r\n        const instance = new web3.eth.Contract(\r\n          VoteContract.abi,\r\n          address\r\n        );\r\n        return (await instance.methods.currentElection().call());\r\n        // Set web3, accounts, and contract to the state, and then proceed with an\r\n      } catch (error) {\r\n        // Catch any errors for any of the above operations.\r\n        alert(\r\n          `Failed to load web3, accounts, or contract. Check console for details.`,\r\n        );\r\n        console.error(error);\r\n      }\r\n    };\r\n    var renderVotes = async () => {\r\n      if (!votesAddresses){\r\n        return;\r\n      }\r\n      var temp = []\r\n      votesAddresses.forEach(address => {\r\n          displayInfo(address).then(newAddress =>\r\n          temp.push(newAddress)\r\n        )\r\n      })\r\n      renderAddresses(temp);\r\n    }\r\n      \r\n    displayVotes();\r\n    renderVotes();\r\n  },[contract]);\r\n\r\n  function displayVoteList() {\r\n    if(renderedAddresses == \"\"){\r\n      return <div>no votes to display</div>\r\n    }\r\n    return renderedAddresses.map((vote, index) => \r\n        <Link className=\"ui button\" route ={`/elections/vote/${vote}`} key={index}>\r\n        <div className=\"ui link card\" style={{width:\"80%\"}}>\r\n        <div className=\"card\">\r\n        <div className=\"content\">\r\n          <div className=\"header\">Election</div>\r\n          <div className=\"meta\">\r\n            <a>{vote}</a>\r\n          </div>\r\n          <div className=\"description\">\r\n            Click to Vote\r\n          </div>\r\n        </div>\r\n        <div className=\"extra content\">\r\n          <span>\r\n            <i className=\"user icon\"></i>\r\n            0 votes\r\n          </span>\r\n        </div>\r\n        </div></div></Link>\r\n      )\r\n    }\r\n\r\n  function clicked() {\r\n    console.log(renderedAddresses)\r\n  }\r\n  async function initWeb3(){\r\n    if (web3 = \"\") {\r\n      setWeb3(await getWeb3())\r\n    }\r\n  }\r\n  return( \r\n    <>\r\n      <Header></Header>\r\n      <br></br>\r\n      <br></br>\r\n      <br></br>\r\n      <br></br>\r\n      <div className=\"App\">\r\n        <button onClick={clicked}></button>\r\n        {/* <div>{ displayrenderedVotes() }</div> */}\r\n        <div>{displayVoteList()}</div> \r\n      </div>\r\n    </>\r\n  );\r\n}\r\n\r\nexport default App;\r\n"]},"metadata":{},"sourceType":"module"}