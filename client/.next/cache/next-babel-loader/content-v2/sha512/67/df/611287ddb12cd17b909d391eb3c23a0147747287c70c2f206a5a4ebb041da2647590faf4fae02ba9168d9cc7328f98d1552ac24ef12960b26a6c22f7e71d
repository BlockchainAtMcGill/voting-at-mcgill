{"ast":null,"code":"import _slicedToArray from \"@babel/runtime/helpers/esm/slicedToArray\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\n\nvar _jsxFileName = \"C:\\\\Users\\\\foubroker\\\\Desktop\\\\voting-at-mcgill\\\\client\\\\src\\\\pages\\\\index.js\",\n    _s = $RefreshSig$();\n\nvar __jsx = React.createElement;\nimport React, { useState, useEffect } from \"react\";\nimport VoteFactoryContract from \"../contracts/VoteFactory.json\";\nimport VoteContract from \"../contracts/Vote.json\";\nimport getWeb3 from \"../getWeb3\";\nimport { Header } from '../components/header';\nimport { Link } from '../../routes';\nimport 'semantic-ui-css/semantic.min.css';\nimport Web3 from \"web3\"; // CommonJS\n\nrequire(\"regenerator-runtime/runtime\");\n\nvar styles = {\n  card: {\n    width: '90%',\n    margin: 'auto',\n    color: '#f00000',\n    maxHeight: 200,\n    minHeight: 200,\n    cursor: \"pointer\"\n  },\n  title: {\n    fontSize: 36,\n    color: '#ED1B2F',\n    marginLeft: 10,\n    marginTop: 15,\n    marginBottom: 15\n  },\n  access: {\n    position: \"relative\",\n    height: 36,\n    fontSize: 16\n  }\n};\n\nfunction App() {\n  _s();\n\n  var _useState = useState(''),\n      web3 = _useState[0],\n      setWeb3 = _useState[1];\n\n  var _useState2 = useState(''),\n      votesAddresses = _useState2[0],\n      setVotesAddresses = _useState2[1];\n\n  var _useState3 = useState(''),\n      contract = _useState3[0],\n      setContract = _useState3[1];\n\n  var _useState4 = useState([]),\n      votes = _useState4[0],\n      setVotes = _useState4[1];\n\n  var _useState5 = useState(''),\n      currentUser = _useState5[0],\n      setCurrentUser = _useState5[1];\n\n  var _useState6 = useState([]),\n      groups = _useState6[0],\n      setGroups = _useState6[1];\n\n  var _useState7 = useState([]),\n      youVoted = _useState7[0],\n      setYouVoted = _useState7[1];\n\n  useEffect(function () {\n    // get web3\n    function initWeb3() {\n      return _initWeb.apply(this, arguments);\n    }\n\n    function _initWeb() {\n      _initWeb = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n        var web3Instance;\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                console.log('initializing web3');\n                _context.next = 3;\n                return getWeb3();\n\n              case 3:\n                web3Instance = _context.sent;\n                setWeb3(web3Instance);\n\n              case 5:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee);\n      }));\n      return _initWeb.apply(this, arguments);\n    }\n\n    initWeb3();\n  }, []);\n  useEffect(function () {\n    // get Factory contract\n    function setup() {\n      return _setup.apply(this, arguments);\n    }\n\n    function _setup() {\n      _setup = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n        var networkId, deployedNetwork, instance, _yield$web3$eth$getAc, _yield$web3$eth$getAc2, user, instance1;\n\n        return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                if (!(web3 == \"\")) {\n                  _context2.next = 3;\n                  break;\n                }\n\n                console.log('unable to get factory');\n                return _context2.abrupt(\"return\");\n\n              case 3:\n                _context2.prev = 3;\n                _context2.next = 6;\n                return web3.eth.net.getId();\n\n              case 6:\n                networkId = _context2.sent;\n                deployedNetwork = VoteFactoryContract.networks[networkId];\n                instance = new web3.eth.Contract(VoteFactoryContract.abi, deployedNetwork && deployedNetwork.address);\n                setContract(instance);\n                _context2.next = 12;\n                return web3.eth.getAccounts();\n\n              case 12:\n                _yield$web3$eth$getAc = _context2.sent;\n                _yield$web3$eth$getAc2 = _slicedToArray(_yield$web3$eth$getAc, 1);\n                user = _yield$web3$eth$getAc2[0];\n                setCurrentUser(user);\n\n                if (!user) {\n                  _context2.next = 21;\n                  break;\n                }\n\n                _context2.next = 19;\n                return instance.methods.getUserAllGroups(user).call();\n\n              case 19:\n                instance1 = _context2.sent;\n                setGroups(instance1);\n\n              case 21:\n                _context2.next = 27;\n                break;\n\n              case 23:\n                _context2.prev = 23;\n                _context2.t0 = _context2[\"catch\"](3);\n                // Catch any errors for any of the above operations.\n                alert(\"Failed to load web3, accounts, or contract. Check console for details.\");\n                console.error(_context2.t0);\n\n              case 27:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, null, [[3, 23]]);\n      }));\n      return _setup.apply(this, arguments);\n    }\n\n    setup(); // console.log('ok')\n  }, [web3]);\n  useEffect(function () {\n    //display available votes addresses\n    var displayVotes = /*#__PURE__*/function () {\n      var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3() {\n        var response;\n        return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                if (!(contract == '')) {\n                  _context3.next = 2;\n                  break;\n                }\n\n                return _context3.abrupt(\"return\");\n\n              case 2:\n                _context3.next = 4;\n                return contract.methods.getDeployedVotes().call();\n\n              case 4:\n                response = _context3.sent;\n                // Update state with the result.\n                setVotesAddresses(response);\n\n              case 6:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3);\n      }));\n\n      return function displayVotes() {\n        return _ref.apply(this, arguments);\n      };\n    }();\n\n    displayVotes();\n  }, [contract]);\n\n  var displayInfo = /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee4(address) {\n      var instance, election, petition;\n      return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n        while (1) {\n          switch (_context4.prev = _context4.next) {\n            case 0:\n              _context4.prev = 0;\n              // Get the contract instance.\n              instance = new web3.eth.Contract(VoteContract.abi, address);\n              _context4.next = 4;\n              return instance.methods.voteType().call();\n\n            case 4:\n              _context4.t0 = _context4.sent;\n\n              if (!(_context4.t0 == 0)) {\n                _context4.next = 17;\n                break;\n              }\n\n              _context4.next = 8;\n              return instance.methods.getElection().call();\n\n            case 8:\n              election = _context4.sent;\n\n              if (!groups.some(function (r) {\n                return election.aGroupIDs.includes(r);\n              })) {\n                _context4.next = 15;\n                break;\n              }\n\n              _context4.t1 = election;\n              _context4.next = 13;\n              return instance.methods.getVoted(currentUser).call();\n\n            case 13:\n              _context4.t2 = _context4.sent;\n              return _context4.abrupt(\"return\", [_context4.t1, _context4.t2]);\n\n            case 15:\n              _context4.next = 26;\n              break;\n\n            case 17:\n              _context4.next = 19;\n              return instance.methods.getPetition().call();\n\n            case 19:\n              petition = _context4.sent;\n\n              if (!groups.some(function (r) {\n                return petition.aGroupIDs.includes(r);\n              })) {\n                _context4.next = 26;\n                break;\n              }\n\n              _context4.t3 = petition;\n              _context4.next = 24;\n              return instance.methods.getVoted(currentUser).call();\n\n            case 24:\n              _context4.t4 = _context4.sent;\n              return _context4.abrupt(\"return\", [_context4.t3, _context4.t4]);\n\n            case 26:\n              _context4.next = 31;\n              break;\n\n            case 28:\n              _context4.prev = 28;\n              _context4.t5 = _context4[\"catch\"](0);\n              console.error(_context4.t5);\n\n            case 31:\n            case \"end\":\n              return _context4.stop();\n          }\n        }\n      }, _callee4, null, [[0, 28]]);\n    }));\n\n    return function displayInfo(_x) {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n\n  useEffect(function () {\n    //render votes\n    var renderVotes = /*#__PURE__*/function () {\n      var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee5() {\n        var tempVotes, tempVoted;\n        return _regeneratorRuntime.wrap(function _callee5$(_context5) {\n          while (1) {\n            switch (_context5.prev = _context5.next) {\n              case 0:\n                if (!(!votesAddresses || !currentUser)) {\n                  _context5.next = 2;\n                  break;\n                }\n\n                return _context5.abrupt(\"return\");\n\n              case 2:\n                tempVotes = [];\n                tempVoted = [];\n                _context5.next = 6;\n                return votesAddresses.forEach(function (address) {\n                  displayInfo(address).then(function (voteInfo) {\n                    if (voteInfo) {\n                      tempVotes.push(voteInfo[0]);\n                      tempVoted.push(voteInfo[1]);\n                    }\n                  });\n                });\n\n              case 6:\n                setTimeout(function () {\n                  setVotes(tempVotes);\n                  setYouVoted(tempVoted);\n                }, 1000);\n\n              case 7:\n              case \"end\":\n                return _context5.stop();\n            }\n          }\n        }, _callee5);\n      }));\n\n      return function renderVotes() {\n        return _ref3.apply(this, arguments);\n      };\n    }();\n\n    renderVotes();\n  }, [groups]);\n  useEffect(function () {\n    console.log(votes);\n    console.log(groups);\n  }, [votes]);\n\n  function displayElectionsList() {\n    var _this = this;\n\n    if (web3 == \"\") {\n      return \"waiting for votes to display...\";\n    } else if (votesAddresses == \"\") {\n      return \"no votes to display\";\n    }\n\n    return votes ? votes.map(function (vote, index) {\n      return __jsx(Link, {\n        className: \"ui button\",\n        route: \"/\".concat(vote.aTypeOfElection ? \"elections\" : \"petitions\", \"/vote/\").concat(vote.aVoteAddress),\n        key: index,\n        __self: _this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 164,\n          columnNumber: 11\n        }\n      }, __jsx(\"div\", {\n        className: \"ui card\",\n        style: styles.card,\n        __self: _this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 165,\n          columnNumber: 13\n        }\n      }, __jsx(\"div\", {\n        className: \"card\",\n        __self: _this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 166,\n          columnNumber: 15\n        }\n      }, __jsx(\"span\", {\n        className: \"right floated\",\n        __self: _this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 167,\n          columnNumber: 17\n        }\n      }, vote.aNumVotes, __jsx(\"i\", {\n        className: \"user icon\",\n        style: {\n          margin: 3\n        },\n        __self: _this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 169,\n          columnNumber: 19\n        }\n      }), youVoted[index] ? __jsx(\"i\", {\n        className: \"check circle icon\",\n        style: {\n          margin: 3\n        },\n        __self: _this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 170,\n          columnNumber: 38\n        }\n      }) : __jsx(\"i\", {\n        className: \"circle outline icon\",\n        style: {\n          margin: 3\n        },\n        __self: _this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 170,\n          columnNumber: 99\n        }\n      })), __jsx(\"div\", {\n        className: \"content\",\n        __self: _this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 174,\n          columnNumber: 17\n        }\n      }, __jsx(\"div\", {\n        className: \"header\",\n        style: styles.title,\n        __self: _this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 175,\n          columnNumber: 19\n        }\n      }, vote.aTitle, \" -\", vote.aVoteStatus == 0 ? \" starts on \" + new Date(vote.aStartDate * 1).toUTCString().slice(0, 17) : vote.aVoteStatus == 1 ? \" ends on \" + new Date(vote.aEndDate * 1).toUTCString().slice(0, 17) : \"archived: \" + new Date(vote.aEndDate * 1).toUTCString().slice(0, 17))), __jsx(\"div\", {\n        className: \"content\",\n        __self: _this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 184,\n          columnNumber: 17\n        }\n      }, __jsx(\"span\", {\n        className: \"right floated\",\n        __self: _this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 186,\n          columnNumber: 19\n        }\n      }, __jsx(\"span\", {\n        style: styles.access,\n        __self: _this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 187,\n          columnNumber: 21\n        }\n      }, \"access vote\"), __jsx(\"i\", {\n        className: \"angle right icon huge\",\n        __self: _this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 188,\n          columnNumber: 21\n        }\n      })), __jsx(\"div\", {\n        className: \"ui sub header\",\n        style: {\n          marginLeft: 10\n        },\n        __self: _this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 191,\n          columnNumber: 19\n        }\n      }, __jsx(\"i\", {\n        className: \"checkmark icon small\",\n        __self: _this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 192,\n          columnNumber: 21\n        }\n      }), vote.aTypeOfElection ? \"Election\" + \" | type of vote : \" + (vote.aVoteType == \"0\" ? \"Majority\" : \"Two-Thirds\") : \"Petition\"), __jsx(\"div\", {\n        className: \"ui feed\",\n        style: {\n          marginLeft: 10\n        },\n        __self: _this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 195,\n          columnNumber: 19\n        }\n      }, vote.aDescription)))));\n    }) : __jsx(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 200,\n        columnNumber: 11\n      }\n    }, \" no votes found \");\n  }\n\n  return __jsx(React.Fragment, null, __jsx(Header, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 205,\n      columnNumber: 7\n    }\n  }), __jsx(\"br\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 206,\n      columnNumber: 7\n    }\n  }), __jsx(\"br\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 207,\n      columnNumber: 7\n    }\n  }), __jsx(\"br\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 208,\n      columnNumber: 7\n    }\n  }), __jsx(\"br\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 209,\n      columnNumber: 7\n    }\n  }), __jsx(\"div\", {\n    className: \"App\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 210,\n      columnNumber: 7\n    }\n  }, __jsx(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 211,\n      columnNumber: 9\n    }\n  }, displayElectionsList())));\n}\n\n_s(App, \"hzjQsS3NafZNIPdgZzqfFd2udgg=\");\n\n_c = App;\nexport default App;\n\nvar _c;\n\n$RefreshReg$(_c, \"App\");","map":{"version":3,"sources":["C:/Users/foubroker/Desktop/voting-at-mcgill/client/src/pages/index.js"],"names":["React","useState","useEffect","VoteFactoryContract","VoteContract","getWeb3","Header","Link","Web3","require","styles","card","width","margin","color","maxHeight","minHeight","cursor","title","fontSize","marginLeft","marginTop","marginBottom","access","position","height","App","web3","setWeb3","votesAddresses","setVotesAddresses","contract","setContract","votes","setVotes","currentUser","setCurrentUser","groups","setGroups","youVoted","setYouVoted","initWeb3","console","log","web3Instance","setup","eth","net","getId","networkId","deployedNetwork","networks","instance","Contract","abi","address","getAccounts","user","methods","getUserAllGroups","call","instance1","alert","error","displayVotes","getDeployedVotes","response","displayInfo","voteType","getElection","election","some","r","aGroupIDs","includes","getVoted","getPetition","petition","renderVotes","tempVotes","tempVoted","forEach","then","voteInfo","push","setTimeout","displayElectionsList","map","vote","index","aTypeOfElection","aVoteAddress","aNumVotes","aTitle","aVoteStatus","Date","aStartDate","toUTCString","slice","aEndDate","aVoteType","aDescription"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from \"react\";\r\nimport VoteFactoryContract from \"../contracts/VoteFactory.json\";\r\nimport VoteContract from \"../contracts/Vote.json\";\r\nimport getWeb3 from \"../getWeb3\";\r\nimport { Header } from '../components/header';\r\nimport { Link } from '../../routes'\r\nimport 'semantic-ui-css/semantic.min.css';\r\nimport Web3 from \"web3\";\r\n// CommonJS\r\nrequire(\"regenerator-runtime/runtime\");\r\n\r\n\r\nconst styles = {\r\n  card: {\r\n    width: '90%',\r\n    margin: 'auto',\r\n    color: '#f00000',\r\n    maxHeight: 200,\r\n    minHeight: 200,\r\n    cursor: \"pointer\",\r\n  },\r\n  title : {\r\n    fontSize: 36,\r\n    color: '#ED1B2F',\r\n    marginLeft: 10,\r\n    marginTop: 15,\r\n    marginBottom:15\r\n  },\r\n  access:{\r\n    position:\"relative\",\r\n    height:36,\r\n    fontSize: 16,\r\n  }\r\n};\r\n\r\nfunction App() {\r\n  const [web3, setWeb3] = useState('');\r\n  const [votesAddresses, setVotesAddresses] = useState('');\r\n  const [contract, setContract] = useState('');\r\n  const [votes, setVotes] = useState([]);\r\n  const [currentUser, setCurrentUser] = useState('');\r\n  const [groups, setGroups] = useState([]);\r\n  const [youVoted, setYouVoted] = useState([]);\r\n\r\n  useEffect(() => {// get web3\r\n    async function initWeb3() {\r\n      console.log('initializing web3');\r\n      const web3Instance = await getWeb3();\r\n      setWeb3(web3Instance)\r\n    }\r\n    initWeb3();\r\n  },[]);\r\n\r\n  useEffect(() => {// get Factory contract\r\n    async function setup() {\r\n      if(web3 == \"\") {\r\n        console.log('unable to get factory')\r\n        return;\r\n      }\r\n      try {\r\n        // Get the contract instance.\r\n        const networkId = await web3.eth.net.getId();\r\n        const deployedNetwork = VoteFactoryContract.networks[networkId];\r\n        const instance = new web3.eth.Contract(\r\n          VoteFactoryContract.abi,\r\n          deployedNetwork && deployedNetwork.address,\r\n        );\r\n        setContract(instance);\r\n        const [user] = await web3.eth.getAccounts();\r\n        setCurrentUser(user);\r\n        if (user) {\r\n          const instance1 = await instance.methods.getUserAllGroups(user).call();\r\n          setGroups(instance1);\r\n        }\r\n    \r\n        // Set web3, accounts, and contract to the state, and then proceed with an\r\n      } catch (error) {\r\n        // Catch any errors for any of the above operations.\r\n        alert(\r\n          `Failed to load web3, accounts, or contract. Check console for details.`,\r\n        );\r\n        console.error(error);\r\n      }\r\n\r\n      \r\n    }\r\n      setup();\r\n      // console.log('ok')\r\n  },[web3]);\r\n\r\n  useEffect(()=> {//display available votes addresses\r\n    var displayVotes = async () => {\r\n      if(contract == ''){\r\n        return;\r\n      }\r\n      const response = await contract.methods.getDeployedVotes().call();\r\n      // Update state with the result.\r\n      setVotesAddresses(response);\r\n    };\r\n    displayVotes();\r\n  },[contract]);\r\n\r\n\r\n  var displayInfo = async (address) => { \r\n    try {// Get the contract instance.\r\n      const instance = new web3.eth.Contract(\r\n        VoteContract.abi,\r\n        address\r\n      );\r\n      if((await instance.methods.voteType().call()) == 0) {\r\n        const election = await instance.methods.getElection().call();//we take a filter\r\n        if(groups.some(r=> election.aGroupIDs.includes(r))){//https://stackoverflow.com/questions/16312528/check-if-an-array-contains-any-element-of-another-array-in-javascript\r\n          return [election, await instance.methods.getVoted(currentUser).call()];\r\n        }\r\n      }\r\n      else{\r\n        const petition = await instance.methods.getPetition().call();\r\n        if(groups.some(r=> petition.aGroupIDs.includes(r))) {\r\n        return [petition, await instance.methods.getVoted(currentUser).call()]\r\n        }\r\n      }\r\n    } catch (error) {\r\n      console.error(error);\r\n    }\r\n  };\r\n  \r\n  useEffect(()=> {//render votes\r\n    var renderVotes = async () => {\r\n        if (!votesAddresses || !currentUser){\r\n          return;\r\n        }\r\n        var tempVotes  = [];\r\n        var tempVoted = [];\r\n        await votesAddresses.forEach(address => {\r\n            displayInfo(address).then(voteInfo => {\r\n              if(voteInfo){\r\n              tempVotes.push(voteInfo[0]);\r\n              tempVoted.push(voteInfo[1]);\r\n              }\r\n          })\r\n        })\r\n        setTimeout(function(){\r\n            setVotes(tempVotes);\r\n            setYouVoted(tempVoted);\r\n          }, 1000);\r\n\r\n      }\r\n    renderVotes();\r\n  },[groups]);\r\n\r\n  useEffect(()=> {\r\n    console.log(votes);\r\n    console.log(groups);\r\n  },[votes])\r\n\r\n  function displayElectionsList() {\r\n    if(web3 == \"\"){\r\n      return \"waiting for votes to display...\"\r\n    }\r\n    else if(votesAddresses == \"\"){\r\n      return \"no votes to display\"\r\n    }\r\n    return votes ? votes.map((vote, index) => \r\n          <Link className=\"ui button\" route ={`/${vote.aTypeOfElection ? \"elections\" : \"petitions\" }/vote/${vote.aVoteAddress}`} key={index}>\r\n            <div className=\"ui card\" style={styles.card}>\r\n              <div className=\"card\">\r\n                <span className=\"right floated\">\r\n                  {vote.aNumVotes}\r\n                  <i className=\"user icon\" style={{margin: 3}}></i>\r\n                  {youVoted[index] ? <i className=\"check circle icon\" style={{margin: 3}}></i>  : <i className=\"circle outline icon\" style={{margin: 3}}></i>}\r\n                  \r\n                </span>\r\n\r\n                <div className=\"content\">\r\n                  <div className=\"header\" style={styles.title}>\r\n                      {vote.aTitle} - \r\n                      { vote.aVoteStatus == 0 ? \" starts on \" + new Date(vote.aStartDate * 1).toUTCString().slice(0,17) : \r\n                      ( vote.aVoteStatus == 1 ? \" ends on \" + new Date(vote.aEndDate * 1).toUTCString().slice(0,17):\r\n                       \"archived: \" + new Date(vote.aEndDate * 1).toUTCString().slice(0,17)\r\n                      )\r\n                      }\r\n                  </div>\r\n                </div>\r\n                <div className=\"content\">\r\n\r\n                  <span className=\"right floated\">\r\n                    <span style={styles.access} >access vote</span>\r\n                    <i className=\"angle right icon huge\"></i>\r\n                  </span>\r\n                  \r\n                  <div className=\"ui sub header\" style={{marginLeft:10}}>\r\n                    <i className=\"checkmark icon small\"></i>  \r\n                    {vote.aTypeOfElection ?  (\"Election\" + \" | type of vote : \" + (vote.aVoteType == \"0\" ? \"Majority\" : \"Two-Thirds\")) : \"Petition\" }  \r\n                  </div>\r\n                  <div className=\"ui feed\" style={{marginLeft:10}}>{ vote.aDescription }</div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </Link>\r\n      ) : <div> no votes found </div>\r\n    }\r\n\r\n  return( \r\n    <>\r\n      <Header></Header>\r\n      <br></br>\r\n      <br></br>\r\n      <br></br>\r\n      <br></br>\r\n      <div className=\"App\">\r\n        <div>{ displayElectionsList() }</div>\r\n      </div>\r\n    </>\r\n  );\r\n}\r\n\r\nexport default App;\r\n"]},"metadata":{},"sourceType":"module"}