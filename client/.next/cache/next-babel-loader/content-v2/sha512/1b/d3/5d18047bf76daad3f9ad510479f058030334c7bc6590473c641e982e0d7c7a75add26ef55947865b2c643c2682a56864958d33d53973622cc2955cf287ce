{"ast":null,"code":"var _jsxFileName = \"/home/wen_wong/voting-at-mcgill/client/src/pages/elections/apply/apply.js\";\nvar __jsx = React.createElement;\nimport React, { useState, useEffect } from 'react';\nimport { Header } from '../../../components/header';\nimport VoteFactoryContract from \"../../../contracts/VoteFactory.json\";\nimport VoteContract from \"../../../contracts/Vote.json\";\nimport { Form } from \"semantic-ui-react\";\nimport getWeb3 from \"../../../getWeb3\";\nimport 'semantic-ui-css/semantic.min.css';\nimport Router from 'next/router';\nconst candFields = {\n  margin: \"auto 5% auto 5%\"\n};\nconst candTitle = {\n  color: \"red\",\n  marginBottom: \"5%\",\n  fontSize: \"3em\",\n  textAlign: \"center\"\n};\n\nconst Apply = () => {\n  const {\n    0: web3,\n    1: setWeb3\n  } = useState('');\n  var web3Instance;\n  useEffect(() => {\n    async function initWeb3() {\n      web3Instance = await getWeb3();\n      setWeb3(web3Instance);\n    }\n\n    initWeb3();\n  }, []); //please follow the course for a better implementation @Jing\n\n  const {\n    0: candidateName,\n    1: setName\n  } = useState('');\n  const {\n    0: currentDate,\n    1: setCurrentDate\n  } = useState(0);\n  const {\n    0: description,\n    1: setDescription\n  } = useState('');\n\n  var onSubmit = async event => {\n    event.preventDefault();\n    var manager;\n    var factoryContract;\n    var voteContract;\n    var addressOfVote;\n\n    var setupVoteFactory = async () => {\n      //initializes voteFactory\n      if (web3 == '') {\n        return;\n      }\n\n      try {\n        [manager] = await web3.eth.getAccounts(); // Get the contract instance.\n\n        const networkId = await web3.eth.net.getId();\n        const deployedNetwork = VoteFactoryContract.networks[networkId];\n        const instance = new web3.eth.Contract(VoteFactoryContract.abi, deployedNetwork && deployedNetwork.address);\n        factoryContract = instance; // Set web3, accounts, and contract to the state, and then proceed with an\n      } catch (error) {\n        // Catch any errors for any of the above operations.\n        alert(`Failed to load web3, accounts, or contract. Check console for details.`);\n        console.error(error);\n      }\n    };\n\n    var getElectionAddress = async () => {\n      const url = window.location.href;\n      const pos = url.indexOf('y') + 2;\n      addressOfVote = url.slice(pos);\n      console.log(addressOfVote);\n    };\n\n    var initializeElection = async () => {\n      //initializes vote contract\n      try {\n        // Get the contract instance.\n        const instance = await new web3.eth.Contract(VoteContract.abi, addressOfVote);\n        voteContract = instance;\n      } catch (error) {\n        // Catch any errors for any of the above operations.\n        alert(`Failed to load web3, accounts, or contract. Check console for details.`);\n        console.error(error);\n      }\n    };\n\n    var setCandidate = async () => {\n      await voteContract.methods.enterElection(candidateName, description, new Date(currentDate).getTime()).send({\n        from: manager\n      });\n    };\n\n    var displayCand = async () => {\n      // testing purposes\n      const summary = await voteContract.methods.get_candidate(manager).call();\n      console.log(summary);\n    };\n\n    await setupVoteFactory();\n    await getElectionAddress();\n    await initializeElection();\n    await setCandidate();\n    await displayCand();\n    const votePage = \"/elections/vote/\" + addressOfVote;\n    Router.push(votePage);\n  };\n\n  return __jsx(React.Fragment, null, __jsx(Header, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 108,\n      columnNumber: 13\n    }\n  }), __jsx(\"br\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 109,\n      columnNumber: 13\n    }\n  }), __jsx(\"br\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 110,\n      columnNumber: 13\n    }\n  }), __jsx(\"br\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 111,\n      columnNumber: 13\n    }\n  }), __jsx(\"h1\", {\n    style: candTitle,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 112,\n      columnNumber: 13\n    }\n  }, \"Run for Election\"), __jsx(\"h3\", {\n    style: {\n      color: \"red\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 113,\n      columnNumber: 13\n    }\n  }, \" \"), __jsx(Form, {\n    onSubmit: onSubmit,\n    style: candFields,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 114,\n      columnNumber: 13\n    }\n  }, __jsx(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 115,\n      columnNumber: 17\n    }\n  }, __jsx(Form.Input, {\n    required: true,\n    label: \"Enter Name\",\n    value: candidateName,\n    onChange: event => setName(event.target.value),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 116,\n      columnNumber: 21\n    }\n  })), __jsx(\"br\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 124,\n      columnNumber: 17\n    }\n  }), __jsx(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 126,\n      columnNumber: 17\n    }\n  }, __jsx(Form.Input, {\n    label: \"Current date\",\n    type: \"date\",\n    value: currentDate,\n    onChange: event => setCurrentDate(event.target.value),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 127,\n      columnNumber: 21\n    }\n  })), __jsx(\"br\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 136,\n      columnNumber: 17\n    }\n  }), __jsx(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 138,\n      columnNumber: 17\n    }\n  }, __jsx(Form.TextArea, {\n    required: true,\n    label: \"Description\",\n    value: description,\n    onChange: event => setDescription(event.target.value),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 139,\n      columnNumber: 21\n    }\n  })), __jsx(\"br\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 147,\n      columnNumber: 17\n    }\n  }), __jsx(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 148,\n      columnNumber: 17\n    }\n  }, __jsx(Form.Button, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 149,\n      columnNumber: 21\n    }\n  }, \"Cancel\"), __jsx(Form.Button, {\n    type: \"submit\",\n    onSubmit: onSubmit,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 150,\n      columnNumber: 21\n    }\n  }, \"Run for Election\"))));\n};\n/*Apply.getInitialProps = async (props) => {\n    console.log(props.query.address)\n    return {VoteContract: props.query.address}\n  };\n*/\n\n\nexport default Apply;","map":{"version":3,"sources":["/home/wen_wong/voting-at-mcgill/client/src/pages/elections/apply/apply.js"],"names":["React","useState","useEffect","Header","VoteFactoryContract","VoteContract","Form","getWeb3","Router","candFields","margin","candTitle","color","marginBottom","fontSize","textAlign","Apply","web3","setWeb3","web3Instance","initWeb3","candidateName","setName","currentDate","setCurrentDate","description","setDescription","onSubmit","event","preventDefault","manager","factoryContract","voteContract","addressOfVote","setupVoteFactory","eth","getAccounts","networkId","net","getId","deployedNetwork","networks","instance","Contract","abi","address","error","alert","console","getElectionAddress","url","window","location","href","pos","indexOf","slice","log","initializeElection","setCandidate","methods","enterElection","Date","getTime","send","from","displayCand","summary","get_candidate","call","votePage","push","target","value"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from 'react';\nimport { Header } from '../../../components/header';\nimport VoteFactoryContract from \"../../../contracts/VoteFactory.json\";\nimport VoteContract from \"../../../contracts/Vote.json\";\nimport { Form } from \"semantic-ui-react\";\nimport getWeb3 from \"../../../getWeb3\";\nimport 'semantic-ui-css/semantic.min.css';\nimport Router from 'next/router';\n\nconst candFields = {\n    margin: \"auto 5% auto 5%\"\n};\nconst candTitle = {\n    color: \"red\",\n    marginBottom: \"5%\",\n    fontSize: \"3em\",\n    textAlign: \"center\"\n};\n\nconst Apply = () => {\n\n    const [web3, setWeb3] = useState('');\n    var web3Instance;\n    useEffect(() => {\n        async function initWeb3() {\n            web3Instance = await getWeb3();\n            setWeb3(web3Instance);\n        }\n        initWeb3();\n    },[]);\n\n    //please follow the course for a better implementation @Jing\n    const [candidateName, setName] = useState('');\n    const [currentDate, setCurrentDate] = useState(0);\n    const [description, setDescription] = useState('');\n\n    var onSubmit = async (event) => {\n        event.preventDefault();\n\n        var manager\n        var factoryContract\n        var voteContract;\n        var addressOfVote;\n\n        var setupVoteFactory = async () => { //initializes voteFactory\n            if(web3 == '') {\n                return;\n            }\n            try {\n                [manager] = (await web3.eth.getAccounts());\n                // Get the contract instance.\n                const networkId = await web3.eth.net.getId();\n                const deployedNetwork = VoteFactoryContract.networks[networkId];\n                const instance = new web3.eth.Contract(\n                    VoteFactoryContract.abi,\n                    deployedNetwork && deployedNetwork.address,\n                );\n                factoryContract = instance;\n\n                // Set web3, accounts, and contract to the state, and then proceed with an\n            } catch (error) {\n                // Catch any errors for any of the above operations.\n                alert(\n                    `Failed to load web3, accounts, or contract. Check console for details.`,\n                );\n                console.error(error);\n            }\n        };\n        var getElectionAddress = async() =>{\n            const url=window.location.href;\n            const pos=url.indexOf('y')+2;\n            addressOfVote= url.slice(pos);\n            console.log(addressOfVote);\n        };\n        var initializeElection = async () => {//initializes vote contract\n            try {\n                // Get the contract instance.\n                const instance = await new web3.eth.Contract(\n                    VoteContract.abi,\n                    addressOfVote,\n                );\n                voteContract = instance;\n            } catch (error) {\n                // Catch any errors for any of the above operations.\n                alert(\n                    `Failed to load web3, accounts, or contract. Check console for details.`,\n                );\n                console.error(error);\n            }\n        };\n        var setCandidate = async () => {\n            await voteContract.methods.enterElection(candidateName, description ,new Date(currentDate).getTime()).send({from: manager});\n        };\n        var displayCand = async () => { // testing purposes\n            const summary = await voteContract.methods.get_candidate(manager).call();\n            console.log(summary);\n        };\n        await setupVoteFactory();\n        await getElectionAddress();\n        await initializeElection();\n        await setCandidate();\n        await displayCand();\n        const votePage= \"/elections/vote/\"+ addressOfVote;\n        Router.push(votePage);\n    };\n    return (\n        <>\n            <Header/>\n            <br></br>\n            <br></br>\n            <br></br>\n            <h1 style= {candTitle}>Run for Election</h1>\n            <h3 style={{color: \"red\"}}> </h3>\n            <Form onSubmit={onSubmit} style={candFields}>\n                <div>\n                    <Form.Input required label=\"Enter Name\"\n                                 value={candidateName}\n                                 onChange={event => setName(event.target.value)}\n                    >\n\n                    </Form.Input>\n                </div>\n\n                <br></br>\n\n                <div>\n                    <Form.Input label=\"Current date\" type=\"date\"\n\n                                 value={currentDate}\n                                 onChange={event => setCurrentDate(event.target.value)}\n                    >\n\n                    </Form.Input>\n                </div>\n\n                <br></br>\n\n                <div>\n                    <Form.TextArea required\n                                 label=\"Description\"\n\n                                 value={description}\n                                 onChange={event => setDescription(event.target.value)}\n                    />\n                </div>\n\n                <br></br>\n                <div>\n                    <Form.Button>Cancel</Form.Button>\n                    <Form.Button type=\"submit\" onSubmit={onSubmit}>Run for Election</Form.Button>\n                </div>\n\n\n            </Form>\n\n        </>\n      )\n};\n/*Apply.getInitialProps = async (props) => {\n    console.log(props.query.address)\n    return {VoteContract: props.query.address}\n  };\n*/\nexport default Apply;\n"]},"metadata":{},"sourceType":"module"}